<app-admin-navbar></app-admin-navbar>

<!-- Modern Main Wrapper -->
<div class="main-wrapper">
    <div class="container-fluid py-4">
        <!-- Beautiful Header Section -->
        <div class="header-section">
            <div class="header-content">
                <div class="title-section">
                    <div class="icon-wrapper">
                        <i class="bi bi-buildings"></i>
                    </div>
                    <div>
                        <h1 class="page-title">Organizations</h1>
                        <p class="page-subtitle">Manage and monitor organization accounts</p>
                    </div>
                </div>
                
                <!-- Enhanced Controls Section -->
                <div class="controls-section">
                    <!-- Modern Search Input -->
                    <div class="search-wrapper">
                        <label class="search-label">
                            <i class="bi bi-search me-2"></i>Search Organizations
                        </label>
                        <div class="search-input-container">
                            <input type="text" 
                                   class="modern-search-input" 
                                   placeholder="Enter organization name..."
                                   [ngModel]="searchTerm" 
                                   (ngModelChange)="searchTermChanged($event)" 
                                   [class.searching]="loading">
                            <div class="search-icon">
                                <i class="bi bi-search" *ngIf="!loading"></i>
                                <div class="search-spinner" *ngIf="loading">
                                    <div class="spinner-ring"></div>
                                </div>
                            </div>
                        </div>
                        <div class="search-results-info" *ngIf="searchTerm && !loading">
                            <span *ngIf="(organizations$ | async)?.length === 0" class="no-results">
                                <i class="bi bi-exclamation-circle me-1"></i>No organizations found
                            </span>
                            <span *ngIf="(organizations$ | async)?.length! > 0" class="results-found">
                                <i class="bi bi-check-circle me-1"></i>{{ (organizations$ | async)?.length }} organizations found
                            </span>
                        </div>
                    </div>
                    <!-- Modern Filter Dropdown -->
                    <div class="filter-wrapper">
                        <label class="filter-label">
                            <i class="bi bi-funnel me-2"></i>Filter Status
                        </label>
                        <div class="custom-select-wrapper">
                            <select class="custom-select" [(ngModel)]="currentFilter" (change)="filterOrganizations()">
                                <option [ngValue]="undefined">üè¢ All Organizations</option>
                                <option [ngValue]="true">üü¢ Active Only</option>
                                <option [ngValue]="false">üî¥ Inactive Only</option>
                            </select>
                            <i class="bi bi-chevron-down select-arrow"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modern Loading States -->
        <div class="loading-container" *ngIf="loading">
            <div class="modern-loader">
                <div class="loader-ring"></div>
                <div class="loader-ring"></div>
                <div class="loader-ring"></div>
            </div>
            <div class="loading-text">
                <p *ngIf="!dataLoaded">Loading organizations...</p>
                <p *ngIf="dataLoaded">Refreshing data...</p>
            </div>
        </div>

        <!-- Enhanced Error Message -->
        <div class="error-container" *ngIf="error">
            <div class="error-card">
                <div class="error-icon">
                    <i class="bi bi-exclamation-triangle-fill"></i>
                </div>
                <div class="error-content">
                    <h5 class="error-title">Error Occurred</h5>
                    <p class="error-message">{{ error }}</p>
                    <button class="retry-btn" (click)="filterOrganizations()">
                        <i class="bi bi-arrow-clockwise me-2"></i>Try Again
                    </button>
                </div>
            </div>
        </div>

        <!-- Modern Organizations Display -->
        <div class="organizations-container" [class.loading-opacity]="loading">
            <div *ngIf="!error && ((organizations$ | async)?.length || loading)" class="organizations-content">
                
                <!-- Organizations Grid/Cards -->
                <div class="organizations-grid" *ngIf="(organizations$ | async)?.length! > 0">
                    <div class="organization-card" 
                         *ngFor="let org of organizations$ | async; trackBy: trackByOrgId"
                         [class.inactive-org]="!org.active">
                        
                        <!-- Card Header -->
                        <div class="card-header">
                            <div class="org-info">
                                <div class="org-avatar">
                                    <i class="bi bi-building-fill"></i>
                                </div>
                                <div class="org-details">
                                    <h4 class="org-name">{{ org.organizationName }}</h4>
                                    <p class="org-id">ID: {{ org.organizationId }}</p>
                                </div>
                            </div>
                            <div class="status-badge" 
                                 [class.status-active]="org?.active" 
                                 [class.status-inactive]="!org?.active">
                                <i class="bi" [class.bi-check-circle-fill]="org?.active" [class.bi-x-circle-fill]="!org?.active"></i>
                                <span>{{ org?.active ? 'Active' : 'Inactive' }}</span>
                            </div>
                        </div>
                        
                        <!-- Card Body -->
                        <div class="card-body">
                            <div class="contact-info">
                                <div class="info-item">
                                    <i class="bi bi-envelope-fill"></i>
                                    <span class="info-label">Email:</span>
                                    <span class="info-value">{{ org.organizationEmail }}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Card Actions -->
                        <div class="card-actions">
                            <button class="action-btn activate-btn" 
                                    (click)="toggleStatus(org.organizationId, true)"
                                    [disabled]="org.active"
                                    title="Activate Organization">
                                <i class="bi bi-check-circle"></i>
                                <span>Activate</span>
                            </button>
                            <button class="action-btn deactivate-btn" 
                                    (click)="toggleStatus(org.organizationId, false)"
                                    [disabled]="!org.active"
                                    title="Deactivate Organization">
                                <i class="bi bi-x-circle"></i>
                                <span>Deactivate</span>
                            </button>
                            <button class="action-btn view-btn" 
                                    (click)="viewDetails(org.organizationId)"
                                    title="View Details">
                                <i class="bi bi-eye"></i>
                                <span>View Details</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Empty State -->
                <div class="empty-state" *ngIf="!loading && (organizations$ | async)?.length === 0">
                    <div class="empty-icon">
                        <i class="bi bi-building-x"></i>
                    </div>
                    <h4 class="empty-title">No Organizations Found</h4>
                    <p class="empty-subtitle" *ngIf="!searchTerm && currentFilter === undefined">
                        There are currently no organizations in the system.
                    </p>
                    <p class="empty-subtitle" *ngIf="searchTerm || currentFilter !== undefined">
                        No organizations match your current search or filter criteria.
                    </p>
                    <button class="btn btn-outline-primary" 
                            *ngIf="searchTerm || currentFilter !== undefined"
                            (click)="clearFilters()">
                        <i class="bi bi-arrow-clockwise me-2"></i>Clear Filters
                    </button>
                </div>

                <!-- Modern Pagination -->
                <div class="pagination-container" *ngIf="totalPages > 0">
                    <div class="pagination-info">
                        <div class="page-size-selector">
                            <label class="page-size-label">Items per page:</label>
                            <div class="custom-select-wrapper">
                                <select class="custom-select" [(ngModel)]="pageSize" (change)="onPageSizeChange()">
                                    <option [value]="5">5</option>
                                    <option [value]="10">10</option>
                                    <option [value]="20">20</option>
                                </select>
                                <i class="bi bi-chevron-down select-arrow"></i>
                            </div>
                        </div>
                    </div>
                    
                    <nav class="modern-pagination">
                        <ul class="pagination-list">
                            <li class="page-item">
                                <button class="page-btn first-btn" 
                                        (click)="loadPage(0)"
                                        [disabled]="currentPage === 0">
                                    <i class="bi bi-chevron-double-left"></i>
                                    <span class="btn-text">First</span>
                                </button>
                            </li>
                            <li class="page-item">
                                <button class="page-btn prev-btn" 
                                        (click)="loadPage(currentPage - 1)"
                                        [disabled]="currentPage === 0">
                                    <i class="bi bi-chevron-left"></i>
                                    <span class="btn-text">Previous</span>
                                </button>
                            </li>
                            
                            <li class="page-item" *ngFor="let page of pageNumbers">
                                <button class="page-btn number-btn" 
                                        [class.active]="page === currentPage"
                                        (click)="loadPage(page)">
                                    {{ page + 1 }}
                                </button>
                            </li>
                            
                            <li class="page-item">
                                <button class="page-btn next-btn" 
                                        (click)="loadPage(currentPage + 1)"
                                        [disabled]="currentPage === totalPages - 1">
                                    <span class="btn-text">Next</span>
                                    <i class="bi bi-chevron-right"></i>
                                </button>
                            </li>
                            <li class="page-item">
                                <button class="page-btn last-btn" 
                                        (click)="loadPage(totalPages - 1)"
                                        [disabled]="currentPage === totalPages - 1">
                                    <span class="btn-text">Last</span>
                                    <i class="bi bi-chevron-double-right"></i>
                                </button>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</div>